{% extends '_base.html' %}
{% block title %}Change Password{% endblock title %}

{% block content %}
<main class="content" role="main">
  <h2>{% if token_fail %}Bad Token{% else %}Change Password{% endif %}</h2>

  {% if token_fail %}
    <p style="margin-bottom: calc(var(--line-height) * 2);">The password reset link was invalid. Perhaps it has already been used?</p>
    <p>Please request a <a href="{% url 'account_reset_password' %}">new password reset</a>.</p>
  {% else %}
    {% if form %}
      <form method="POST" action="." class="auth-form">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="form-errors">
            {% for error in form.non_field_errors %}
              <p style="color: var(--text-color-alt); margin-bottom: var(--line-height);">{{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}

        {% for field in form %}
          <div class="form-field" style="margin-bottom: var(--line-height);">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}
            {% if field.errors %}
              {% for error in field.errors %}
                <p style="color: var(--text-color-alt); font-size: 0.875rem; margin-top: calc(var(--line-height) / 2);">{{ error }}</p>
              {% endfor %}
            {% endif %}
            {% if field.help_text %}
              <p style="color: var(--text-color-alt); font-size: 0.875rem; margin-top: calc(var(--line-height) / 2);">{{ field.help_text }}</p>
            {% endif %}
          </div>
        {% endfor %}

        <div style="margin-top: calc(var(--line-height) * 2);">
          <button type="submit" style="width: auto; min-width: 15ch;">Change Password</button>
        </div>
      </form>
    {% else %}
      <p style="margin-bottom: calc(var(--line-height) * 2);">Your password has been changed successfully.</p>
      <p><a href="{% url 'account_login' %}">Log in with your new password</a></p>
    {% endif %}
  {% endif %}
</main>
{% endblock content%}
