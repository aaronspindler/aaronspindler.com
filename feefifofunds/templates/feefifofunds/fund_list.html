{% extends '_base.html' %}

{% block title %}Fund Comparison Tool{% endblock %}

{% block content %}
<div class="container">
  <h1>Fund Comparison Tool</h1>
  <p>Compare high MER mutual funds with low-fee index ETFs</p>

  <!-- Filter Form -->
  <div class="filters">
    <h2>Filter Funds</h2>
    <form method="get" action="{% url 'feefifofunds:fund_list' %}">
      <div class="filter-group">
        <label for="fund_type">Fund Type:</label>
        <select name="fund_type" id="fund_type">
          <option value="">All Types</option>
          {% for value, label in fund_types %}
          <option value="{{ value }}" {% if selected_fund_type == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-group">
        <label for="asset_class">Asset Class:</label>
        <select name="asset_class" id="asset_class">
          <option value="">All Classes</option>
          {% for value, label in asset_classes %}
          <option value="{{ value }}" {% if selected_asset_class == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-group">
        <label for="geographic_focus">Geographic Focus:</label>
        <select name="geographic_focus" id="geographic_focus">
          <option value="">All Regions</option>
          {% for value, label in geographic_focuses %}
          <option value="{{ value }}" {% if selected_geographic_focus == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-group">
        <label for="max_mer">Max MER (%):</label>
        <input type="number" name="max_mer" id="max_mer" step="0.01" min="0" value="{{ selected_max_mer }}" placeholder="e.g., 1.00">
      </div>

      <button type="submit">Apply Filters</button>
      <a href="{% url 'feefifofunds:fund_list' %}">Clear Filters</a>
    </form>
  </div>

  <!-- Fund List -->
  <div class="fund-list">
    <h2>Funds ({{ funds.count }} found)</h2>

    {% if funds %}
    <table>
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Name</th>
          <th>Provider</th>
          <th>Type</th>
          <th>Asset Class</th>
          <th>MER (%)</th>
          <th>1Y Return (%)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for fund in funds %}
        <tr>
          <td><strong>{{ fund.ticker }}</strong></td>
          <td>{{ fund.name }}</td>
          <td>{{ fund.provider.name }}</td>
          <td>{{ fund.get_fund_type_display }}</td>
          <td>{{ fund.get_asset_class_display }}</td>
          <td>{{ fund.mer }}</td>
          <td>{{ fund.one_year_return|default:"-" }}</td>
          <td>
            <a href="{% url 'feefifofunds:fund_detail' fund.slug %}">View Details</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>No funds found matching your criteria. Try adjusting your filters.</p>
    {% endif %}
  </div>

  <!-- Comparison Link -->
  <div class="comparison-section">
    <h2>Compare Multiple Funds</h2>
    <p><a href="{% url 'feefifofunds:compare' %}">Go to Comparison Tool</a></p>
  </div>
</div>
{% endblock %}
