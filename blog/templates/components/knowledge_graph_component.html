{% load static %}

<div class="knowledge-graph-section">
    <div id="knowledge-graph-container">
        <div id="loading">Loading knowledge graph...</div>
        <svg id="knowledge-graph-svg"></svg>
    </div>
</div>

<!-- Lazy load D3.js and knowledge graph when scrolled into view -->
<script>
(function() {
    var container = document.getElementById('knowledge-graph-container');
    var loaded = false;

    var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting && !loaded) {
                loaded = true;
                var d3Script = document.createElement('script');
                d3Script.src = '{% static "js/vendor/d3.v7.min.js" %}';
                d3Script.onload = function() {
                    var kgScript = document.createElement('script');
                    kgScript.src = '{% static "js/knowledge_graph.min.js" %}';
                    kgScript.onload = function() {
                        // Manually instantiate since DOMContentLoaded already fired
                        try {
                            new HomepageKnowledgeGraph();
                        } catch(e) {
                            console.error('Failed to initialize knowledge graph:', e);
                        }
                    };
                    document.body.appendChild(kgScript);
                };
                document.body.appendChild(d3Script);
                observer.disconnect();
            }
        });
    }, { rootMargin: '200px' });

    observer.observe(container);
})();
</script>
