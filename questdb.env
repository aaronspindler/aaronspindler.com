# QuestDB Environment Variables
# Converted from questdb_config.properties for Coolify deployment
#
# Conversion: property.name=value â†’ QDB_PROPERTY_NAME=value
# Balanced for 16GB RAM, 6-8 cores, burst ingestion (20K-50K rows/sec)

# Strict config validation
QDB_CONFIG_VALIDATION_STRICT=true

################ Resource Management ##################

# RAM limit - conservative for 16GB system (leaves 4GB for OS)
QDB_RAM_USAGE_LIMIT_PERCENT=75

# Worker thread pools - matched to your 6-8 core CPU
QDB_SHARED_WORKER_COUNT=6

################ HTTP Server ##################

QDB_HTTP_ENABLED=true
QDB_HTTP_NET_BIND_TO=0.0.0.0:9000
QDB_HTTP_NET_CONNECTION_LIMIT=512
QDB_HTTP_NET_CONNECTION_TIMEOUT=5m
QDB_HTTP_NET_CONNECTION_QUEUE_TIMEOUT=5000
QDB_HTTP_NET_CONNECTION_SNDBUF=2m
QDB_HTTP_NET_CONNECTION_RCVBUF=2m
QDB_HTTP_SEND_BUFFER_SIZE=2m

# HTTP connection type limits
QDB_HTTP_JSON_QUERY_CONNECTION_LIMIT=-1
QDB_HTTP_EXPORT_CONNECTION_LIMIT=-1

# HTTP protocol settings
QDB_HTTP_VERSION=HTTP/1.1
QDB_HTTP_SERVER_KEEP_ALIVE=true
QDB_HTTP_KEEP_ALIVE_TIMEOUT=5
QDB_HTTP_KEEP_ALIVE_MAX=10000

# Query settings - enabled but with moderate cache
QDB_HTTP_QUERY_CACHE_ENABLED=true
QDB_HTTP_QUERY_CACHE_BLOCK_COUNT=16
QDB_HTTP_QUERY_CACHE_ROW_COUNT=4
QDB_QUERY_TIMEOUT=2m

# Security
QDB_HTTP_SECURITY_READONLY=false
QDB_HTTP_SETTINGS_READONLY=false

# Static files
QDB_HTTP_STATIC_PUBLIC_DIRECTORY=public

################ HTTP Min (Health Check) ##################

QDB_HTTP_MIN_ENABLED=true
QDB_HTTP_MIN_NET_BIND_TO=0.0.0.0:9003
QDB_HTTP_PESSIMISTIC_HEALTH_CHECK_ENABLED=false

################ Cairo (Storage Engine) - OPTIMIZED FOR BURSTS ##################

QDB_CAIRO_ROOT=db
QDB_CAIRO_COMMIT_MODE=nosync
# Moderate commit latency to prevent hangs
QDB_CAIRO_COMMIT_LATENCY=45s

# Symbol settings
QDB_CAIRO_DEFAULT_SYMBOL_CACHE_FLAG=true
# Increased for more assets
QDB_CAIRO_DEFAULT_SYMBOL_CAPACITY=384
QDB_CAIRO_AUTO_SCALE_SYMBOL_CAPACITY=true
QDB_CAIRO_AUTO_SCALE_SYMBOL_CAPACITY_THRESHOLD=0.8

# Table operations
QDB_CAIRO_CREATE_AS_SELECT_RETRY_COUNT=5
QDB_CAIRO_FILE_OPERATION_RETRY_COUNT=30
QDB_CAIRO_MAX_FILE_NAME_LENGTH=127

# Reader/Writer pools - balanced
QDB_CAIRO_READER_POOL_MAX_SEGMENTS=8
QDB_CAIRO_INACTIVE_READER_MAX_OPEN_PARTITIONS=96
QDB_CAIRO_INACTIVE_READER_TTL=3m
QDB_CAIRO_INACTIVE_WRITER_TTL=45m

# Performance settings
QDB_CAIRO_PARALLEL_INDEXING_ENABLED=true
QDB_CAIRO_PARALLEL_INDEX_THRESHOLD=100000
QDB_CAIRO_SPIN_LOCK_TIMEOUT=1s
QDB_CAIRO_IDLE_CHECK_INTERVAL=7m

# Memory settings - 2-3x increases (moderate, not aggressive)
QDB_CAIRO_O3_COLUMN_MEMORY_SIZE=24M
QDB_CAIRO_SYSTEM_O3_COLUMN_MEMORY_SIZE=512k
QDB_CAIRO_WRITER_DATA_APPEND_PAGE_SIZE=32M
QDB_CAIRO_WRITER_DATA_INDEX_KEY_APPEND_PAGE_SIZE=1M
QDB_CAIRO_WRITER_DATA_INDEX_VALUE_APPEND_PAGE_SIZE=32M
QDB_CAIRO_SYSTEM_WRITER_DATA_APPEND_PAGE_SIZE=512k

# O3 (Out-of-order) settings - MODERATE INCREASES
QDB_CAIRO_MAX_UNCOMMITTED_ROWS=3000000
QDB_CAIRO_O3_MIN_LAG=3s
# 10 minutes in microseconds
QDB_CAIRO_O3_MAX_LAG=600000000
QDB_CAIRO_O3_PARTITION_PURGE_LIST_INITIAL_CAPACITY=5
QDB_CAIRO_O3_PARTITION_SPLIT_MIN_SIZE=75M
QDB_CAIRO_O3_LAST_PARTITION_MAX_SPLITS=50

# Writer settings - moderate throughput optimization
QDB_CAIRO_WRITER_TICK_ROWS_COUNT=5120
QDB_CAIRO_WRITER_COMMAND_QUEUE_CAPACITY=64
QDB_CAIRO_WRITER_ALTER_BUSY_WAIT_TIMEOUT=750ms

# SQL execution pools - moderate increases
QDB_CAIRO_SQL_SMALL_MAP_KEY_CAPACITY=3145728
QDB_CAIRO_SQL_SMALL_MAP_PAGE_SIZE=6m
QDB_CAIRO_SQL_PAGE_FRAME_MIN_ROWS=300000
QDB_CAIRO_SQL_PAGE_FRAME_MAX_ROWS=3000000

################ Parallel SQL Execution ##################

QDB_CAIRO_SQL_PARALLEL_FILTER_ENABLED=true
QDB_CAIRO_SQL_PARALLEL_GROUPBY_ENABLED=true
QDB_CAIRO_SQL_PARALLEL_GROUPBY_SHARDING_THRESHOLD=100000
QDB_CAIRO_SQL_PARALLEL_READ_PARQUET_ENABLED=true
QDB_CAIRO_SQL_PARALLEL_TOPK_ENABLED=true

# JIT compilation
QDB_CAIRO_SQL_JIT_MODE=on
QDB_CAIRO_SQL_JIT_IR_MEMORY_PAGE_SIZE=12K
QDB_CAIRO_SQL_JIT_IR_MEMORY_MAX_PAGES=12
QDB_CAIRO_SQL_JIT_DEBUG_ENABLED=false

################ SQL Copy (Import/Export) ##################

QDB_CAIRO_SQL_COPY_ROOT=import
QDB_CAIRO_SQL_COPY_EXPORT_ROOT=export
QDB_CAIRO_SQL_COPY_FORMATS_FILE=/text_loader.json
QDB_CAIRO_SQL_COPY_BUFFER_SIZE=4m
QDB_CAIRO_SQL_COPY_MAX_INDEX_CHUNK_SIZE=200M
QDB_CAIRO_SQL_COPY_QUEUE_CAPACITY=64
QDB_CAIRO_SQL_COPY_LOG_RETENTION_DAYS=2

# Parquet export settings
QDB_CAIRO_PARQUET_EXPORT_VERSION=2
QDB_CAIRO_PARQUET_EXPORT_STATISTICS_ENABLED=true
QDB_CAIRO_PARQUET_EXPORT_COMPRESSION_CODEC=ZSTD
QDB_CAIRO_PARQUET_EXPORT_COMPRESSION_LEVEL=6

################ LINE Protocol (ILP) - BURST OPTIMIZED ##################

# Default settings
QDB_LINE_DEFAULT_PARTITION_BY=DAY
QDB_LINE_AUTO_CREATE_NEW_COLUMNS=true
QDB_LINE_AUTO_CREATE_NEW_TABLES=true
QDB_LINE_LOG_MESSAGE_ON_ERROR=true

# LINE TCP (Primary ingestion method) - MODERATE OPTIMIZATION
QDB_LINE_TCP_ENABLED=true
QDB_LINE_TCP_NET_BIND_TO=0.0.0.0:9009
QDB_LINE_TCP_NET_CONNECTION_LIMIT=768
QDB_LINE_TCP_NET_CONNECTION_TIMEOUT=0
QDB_LINE_TCP_NET_CONNECTION_QUEUE_TIMEOUT=7500
QDB_LINE_TCP_NET_CONNECTION_RCVBUF=-1
QDB_LINE_TCP_RECV_BUFFER_SIZE=4096
QDB_LINE_TCP_MAX_MEASUREMENT_SIZE=4096
# 1.5GB
QDB_LINE_TCP_MAX_RECV_BUFFER_SIZE=1610612736

# LINE TCP worker settings - moderate increases
QDB_LINE_TCP_WRITER_QUEUE_CAPACITY=256
QDB_LINE_TCP_WRITER_WORKER_COUNT=0
QDB_LINE_TCP_WRITER_WORKER_YIELD_THRESHOLD=50
QDB_LINE_TCP_WRITER_WORKER_SLEEP_THRESHOLD=50000
QDB_LINE_TCP_IO_WORKER_COUNT=0
QDB_LINE_TCP_DISCONNECT_ON_ERROR=true

# LINE TCP commit settings - OPTIMIZED FOR BURSTS
QDB_LINE_TCP_COMMIT_INTERVAL_FRACTION=0.65
# 5 seconds
QDB_LINE_TCP_COMMIT_INTERVAL_DEFAULT=5000
# 15 seconds
QDB_LINE_TCP_MAINTENANCE_JOB_INTERVAL=15000
QDB_LINE_TCP_MIN_IDLE_MS_BEFORE_WRITER_RELEASE=2000

# LINE UDP (disabled)
QDB_LINE_UDP_ENABLED=false

# LINE HTTP
QDB_LINE_HTTP_ENABLED=true
# 1.5GB
QDB_LINE_HTTP_MAX_RECV_BUFFER_SIZE=1610612736

################ PostgreSQL Wire Protocol ##################

QDB_PG_ENABLED=true
QDB_PG_NET_BIND_TO=0.0.0.0:8812
QDB_PG_NET_CONNECTION_LIMIT=128
QDB_PG_NET_CONNECTION_TIMEOUT=300000
QDB_PG_NET_CONNECTION_QUEUE_TIMEOUT=5m
QDB_PG_NET_CONNECTION_RCVBUF=-1
QDB_PG_NET_CONNECTION_SNDBUF=-1

# PG settings
QDB_PG_CHARACTER_STORE_CAPACITY=4096
QDB_PG_CONNECTION_POOL_CAPACITY=64
QDB_PG_RECV_BUFFER_SIZE=2M
QDB_PG_SEND_BUFFER_SIZE=2M
QDB_PG_MAX_BLOB_SIZE_ON_QUERY=1M
QDB_PG_BINARY_PARAM_COUNT_CAPACITY=2
QDB_PG_NAMED_STATEMENT_LIMIT=10000
QDB_PG_PIPELINE_CAPACITY=96

# PG authentication
QDB_PG_SECURITY_READONLY=false

# PG query cache - enabled with smaller sizes
QDB_PG_SELECT_CACHE_ENABLED=true
QDB_PG_SELECT_CACHE_BLOCK_COUNT=16
QDB_PG_SELECT_CACHE_ROW_COUNT=4
QDB_PG_INSERT_CACHE_ENABLED=true
QDB_PG_INSERT_CACHE_BLOCK_COUNT=2
QDB_PG_INSERT_CACHE_ROW_COUNT=2

################ WAL (Write-Ahead Log) - BURST OPTIMIZED ##################

QDB_CAIRO_WAL_SUPPORTED=true
QDB_CAIRO_WAL_ENABLED_DEFAULT=true

# WAL apply workers - matched to CPU
QDB_WAL_APPLY_WORKER_COUNT=6

# WAL settings - moderate optimization
QDB_CAIRO_WAL_PURGE_INTERVAL=90s
# 2M rows
QDB_CAIRO_WAL_SEGMENT_ROLLOVER_ROW_COUNT=2000000
QDB_CAIRO_WAL_SEGMENT_ROLLOVER_SIZE=0
QDB_CAIRO_WAL_WRITER_DATA_APPEND_PAGE_SIZE=4M
QDB_CAIRO_WAL_WRITER_EVENT_APPEND_PAGE_SIZE=256k
QDB_CAIRO_WAL_WRITER_POOL_MAX_SEGMENTS=15

# WAL apply settings - burst oriented
QDB_CAIRO_WAL_SQUASH_UNCOMMITTED_ROWS_MULTIPLIER=35.0
# 200M
QDB_CAIRO_WAL_MAX_LAG_SIZE=200M
QDB_CAIRO_WAL_MAX_LAG_TXN_COUNT=-1
QDB_CAIRO_WAL_APPLY_LOOK_AHEAD_TXN_COUNT=50
QDB_CAIRO_WAL_APPLY_TABLE_TIME_QUOTA=3s
QDB_CAIRO_WAL_MAX_SEGMENT_FILE_DESCRIPTORS_CACHE=60
QDB_CAIRO_WAL_APPLY_PARALLEL_SQL_ENABLED=true

################ Materialized Views ##################

QDB_CAIRO_MAT_VIEW_ENABLED=true
QDB_CAIRO_MAT_VIEW_PARALLEL_SQL_ENABLED=true
QDB_CAIRO_MAT_VIEW_ROWS_PER_QUERY_ESTIMATE=1000000
QDB_CAIRO_MAT_VIEW_MAX_REFRESH_STEP=31536000000000us
QDB_CAIRO_MAT_VIEW_MAX_REFRESH_RETRIES=10
QDB_CAIRO_MAT_VIEW_REFRESH_OOM_RETRY_TIMEOUT=200
QDB_CAIRO_MAT_VIEW_INSERT_AS_SELECT_BATCH_SIZE=1000000
QDB_CAIRO_MAT_VIEW_MAX_REFRESH_INTERVALS=100
QDB_CAIRO_MAT_VIEW_REFRESH_INTERVALS_UPDATE_PERIOD=15s

################ Telemetry & Metrics ##################

QDB_TELEMETRY_ENABLED=true
QDB_TELEMETRY_QUEUE_CAPACITY=512
QDB_TELEMETRY_HIDE_TABLES=true

QDB_METRICS_ENABLED=true

################ Logging ##################

QDB_LOG_TIMESTAMP_TIMEZONE=UTC
QDB_LOG_TIMESTAMP_LOCALE=en
QDB_LOG_TIMESTAMP_FORMAT=yyyy-MM-ddTHH:mm:ss.SSSUUUz
QDB_LOG_SQL_QUERY_PROGRESS_EXE=true

################ Advanced Settings ##################

# Circuit breaker - moderate increase
QDB_CIRCUIT_BREAKER_THROTTLE=10000000
QDB_NET_TEST_CONNECTION_BUFFER_SIZE=131072

# Date/time
QDB_CAIRO_DATE_LOCALE=en

# IO
QDB_CAIRO_IOURING_ENABLED=true
