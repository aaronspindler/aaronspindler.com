# QuestDB Configuration for High-Volume Historical Data Ingestion
# Optimized for bulk loading of chronologically ordered data
#
# Usage: Use this config during bulk historical data ingestion,
# then switch back to questdb_config.properties for normal operations

# Strict config validation
config.validation.strict=true

################ Resource Management ##################

# RAM limit - increase for bulk ingestion
ram.usage.limit.percent=85

# Worker thread pools - maximize for ingestion
shared.worker.count=8

################ HTTP Server ##################

http.enabled=true
http.net.bind.to=0.0.0.0:9000
http.net.connection.limit=512
http.net.connection.timeout=5m
http.net.connection.queue.timeout=5000
http.net.connection.sndbuf=2m
http.net.connection.rcvbuf=2m
http.send.buffer.size=2m

# HTTP connection type limits
http.json.query.connection.limit=-1
http.export.connection.limit=-1

# HTTP protocol settings
http.version=HTTP/1.1
http.server.keep.alive=true
http.keep-alive.timeout=5
http.keep-alive.max=10000

# Query settings - reduce during bulk ingestion
http.query.cache.enabled=false
query.timeout=5m

# Security
http.security.readonly=false
http.settings.readonly=false

# Static files
http.static.public.directory=public

################ HTTP Min (Health Check) ##################

http.min.enabled=true
http.min.net.bind.to=0.0.0.0:9003
http.pessimistic.health.check.enabled=false

################ Cairo (Storage Engine) - BULK INGESTION OPTIMIZED ##################

cairo.root=db
cairo.commit.mode=nosync
# Increased for bulk ingestion
cairo.commit.latency=60s

# Symbol settings
cairo.default.symbol.cache.flag=true
# Increased for more assets
cairo.default.symbol.capacity=512
cairo.auto.scale.symbol.capacity=true
cairo.auto.scale.symbol.capacity.threshold=0.8

# Table operations
cairo.create.as.select.retry.count=5
cairo.file.operation.retry.count=30
cairo.max.file.name.length=127

# Reader/Writer pools - optimized for write-heavy workload
# Reduced during ingestion
cairo.reader.pool.max.segments=5
# Reduced
cairo.inactive.reader.max.open.partitions=64
# Increased
cairo.inactive.reader.ttl=5m
# Increased for bulk operations
cairo.inactive.writer.ttl=60m

# Performance settings
cairo.parallel.indexing.enabled=true
cairo.parallel.index.threshold=100000
cairo.spin.lock.timeout=1s
# Less frequent checks during ingestion
cairo.idle.check.interval=10m

# Memory settings - SIGNIFICANTLY INCREASED FOR BULK INGESTION
# Increased from 8M
cairo.o3.column.memory.size=256M
# Increased from 256k
cairo.system.o3.column.memory.size=1M
# Increased from 16M
cairo.writer.data.append.page.size=64M
# Increased from 512k
cairo.writer.data.index.key.append.page.size=2M
# Increased from 16M
cairo.writer.data.index.value.append.page.size=64M
# Increased from 256k
cairo.system.writer.data.append.page.size=1M

# O3 (Out-of-order) settings - OPTIMIZED FOR CHRONOLOGICAL BULK LOADING
# Increased from 1M to 10M
cairo.max.uncommitted.rows=10000000
# Increased from 1s
cairo.o3.min.lag=10s
# Increased to 1 hour (3600000000us - microseconds)
cairo.o3.max.lag=3600000000
# Increased
cairo.o3.partition.purge.list.initial.capacity=10
# Increased from 50M
cairo.o3.partition.split.min.size=100M
# Increased from 20
cairo.o3.last.partition.max.splits=100

# Writer settings - optimized for throughput
# Increased from 1024
cairo.writer.tick.rows.count=10240
# Increased from 32
cairo.writer.command.queue.capacity=128
# Increased from 500ms
cairo.writer.alter.busy.wait.timeout=1000ms

# SQL execution pools - increased for bulk operations
# Doubled
cairo.sql.small.map.key.capacity=4194304
# Doubled
cairo.sql.small.map.page.size=8m
# 10x increase
cairo.sql.page.frame.min.rows=1000000
# 10x increase
cairo.sql.page.frame.max.rows=10000000

################ Parallel SQL Execution ##################

cairo.sql.parallel.filter.enabled=true
cairo.sql.parallel.groupby.enabled=true
cairo.sql.parallel.groupby.sharding.threshold=100000
cairo.sql.parallel.read.parquet.enabled=true
cairo.sql.parallel.topk.enabled=true

# JIT compilation
cairo.sql.jit.mode=on
# Increased
cairo.sql.jit.ir.memory.page.size=16K
# Increased
cairo.sql.jit.ir.memory.max.pages=16
cairo.sql.jit.debug.enabled=false

################ SQL Copy (Import/Export) ##################

cairo.sql.copy.root=import
cairo.sql.copy.export.root=export
cairo.sql.copy.formats.file=/text_loader.json
# Increased from 2m
cairo.sql.copy.buffer.size=8m
# Increased from 100M
cairo.sql.copy.max.index.chunk.size=500M
# Increased from 32
cairo.sql.copy.queue.capacity=128
# Reduced during bulk ingestion
cairo.sql.copy.log.retention.days=1

# Parquet export settings
cairo.parquet.export.version=2
cairo.parquet.export.statistics.enabled=true
cairo.parquet.export.compression.codec=ZSTD
# Reduced compression for speed
cairo.parquet.export.compression.level=3

################ LINE Protocol (ILP) - OPTIMIZED FOR BULK INGESTION ##################

# Default settings
line.default.partition.by=DAY
line.auto.create.new.columns=true
line.auto.create.new.tables=true
# Reduced logging during bulk ops
line.log.message.on.error=false

# LINE TCP (Primary ingestion method) - OPTIMIZED FOR THROUGHPUT
line.tcp.enabled=true
line.tcp.net.bind.to=0.0.0.0:9009
# Increased
line.tcp.net.connection.limit=1024
line.tcp.net.connection.timeout=0
# Increased
line.tcp.net.connection.queue.timeout=10000
line.tcp.net.connection.rcvbuf=-1
# Increased from 2048
line.tcp.recv.buffer.size=8192
# Increased from 2048
line.tcp.max.measurement.size=8192
# 2GB, doubled
line.tcp.max.recv.buffer.size=2147483648

# LINE TCP worker settings - increased for throughput
# Increased from 128
line.tcp.writer.queue.capacity=512
line.tcp.writer.worker.count=0
# Increased
line.tcp.writer.worker.yield.threshold=100
# Increased
line.tcp.writer.worker.sleep.threshold=100000
line.tcp.io.worker.count=0
# Don't disconnect during bulk ops
line.tcp.disconnect.on.error=false

# LINE TCP commit settings - OPTIMIZED FOR BATCH PROCESSING
# Increased from 0.5
line.tcp.commit.interval.fraction=0.8
# Increased to 10 seconds
line.tcp.commit.interval.default=10000
# Increased to 30 seconds
line.tcp.maintenance.job.interval=30000
# Increased from 500
line.tcp.min.idle.ms.before.writer.release=5000

# LINE UDP (disabled)
line.udp.enabled=false

# LINE HTTP
line.http.enabled=true
# 2GB, doubled
line.http.max.recv.buffer.size=2147483648

################ PostgreSQL Wire Protocol ##################

pg.enabled=true
pg.net.bind.to=0.0.0.0:8812
pg.net.connection.limit=128
pg.net.connection.timeout=300000
pg.net.connection.queue.timeout=5m
pg.net.connection.rcvbuf=-1
pg.net.connection.sndbuf=-1

# PG settings
pg.character.store.capacity=4096
pg.connection.pool.capacity=64
# Increased
pg.recv.buffer.size=2M
# Increased
pg.send.buffer.size=2M
# Increased
pg.max.blob.size.on.query=1M
pg.binary.param.count.capacity=2
pg.named.statement.limit=10000
# Increased
pg.pipeline.capacity=128

# PG authentication
pg.security.readonly=false

# PG query cache - disabled during bulk ingestion
pg.select.cache.enabled=false
pg.insert.cache.enabled=false

################ WAL (Write-Ahead Log) - OPTIMIZED FOR BULK WRITES ##################

cairo.wal.supported=true
cairo.wal.enabled.default=true

# WAL apply workers - maximize for ingestion
wal.apply.worker.count=8

# WAL settings - optimized for bulk operations
# Increased
cairo.wal.purge.interval=120s
# Increased 10x
cairo.wal.segment.rollover.row.count=5000000
cairo.wal.segment.rollover.size=0
# Increased from 1M
cairo.wal.writer.data.append.page.size=8M
# Increased from 128k
cairo.wal.writer.event.append.page.size=512k
# Increased
cairo.wal.writer.pool.max.segments=20

# WAL apply settings - batch oriented
# Increased
cairo.wal.squash.uncommitted.rows.multiplier=50.0
# Significantly increased from 75M
cairo.wal.max.lag.size=500M
cairo.wal.max.lag.txn.count=-1
# Increased from 20
cairo.wal.apply.look.ahead.txn.count=100
# Increased from 1s
cairo.wal.apply.table.time.quota=5s
# Increased from 30
cairo.wal.max.segment.file.descriptors.cache=100
cairo.wal.apply.parallel.sql.enabled=true

################ Materialized Views ##################

# Disable during bulk ingestion for better performance
cairo.mat.view.enabled=false

################ Telemetry & Metrics ##################

# Reduce telemetry during bulk operations
telemetry.enabled=false
metrics.enabled=true

################ Logging ##################

log.timestamp.timezone=UTC
log.timestamp.locale=en
log.timestamp.format=yyyy-MM-ddTHH:mm:ss.SSSUUUz
# Reduced logging
log.sql.query.progress.exe=false

################ Advanced Settings ##################

# Circuit breaker - increased for bulk operations
# Increased 5x
circuit.breaker.throttle=10000000
# Increased to 256k
net.test.connection.buffer.size=262144

# Date/time
cairo.date.locale=en

# IO
cairo.iouring.enabled=true
