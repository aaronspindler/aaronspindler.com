<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">Dashboard</h1>
        </div>
    </div>    
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="card-title">Actions Status</h5>
                            <div class="mt-3" id="actions-status">
                                <div class="alert alert-secondary" role="alert">
                                    <i class="bi bi-hourglass-split me-2"></i>
                                    Loading status...
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5 class="card-title">Endpoints Status</h5>
                            <div class="mt-3" id="endpoints-status">
                                <div class="alert alert-secondary" role="alert">
                                    <i class="bi bi-hourglass-split me-2"></i>
                                    Loading status...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function updateActionsStatus() {
                fetch('/actions/actions_status')
                    .then(response => response.json())
                    .then(data => {
                        const statusDiv = document.getElementById('actions-status');
                        if (data.all_active) {
                            statusDiv.innerHTML = `
                                <div class="alert alert-success" role="alert">
                                    <i class="bi bi-check-circle-fill me-2"></i>
                                    All actions are currently passing
                                </div>
                            `;
                        } else {
                            statusDiv.innerHTML = `
                                <div class="alert alert-danger" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    Some actions are currently failing
                                </div>
                            `;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const statusDiv = document.getElementById('actions-status');
                        statusDiv.innerHTML = `
                            <div class="alert alert-danger" role="alert">
                                <i class="bi bi-exclamation-circle-fill me-2"></i>
                                Failed to load status
                            </div>
                        `;
                    });
            }
            function updateEndpointsStatus() {
                fetch('/web/endpoints_status')
                    .then(response => response.json())
                    .then(data => {
                        const statusDiv = document.getElementById('endpoints-status');
                        if (data.all_active) {
                            statusDiv.innerHTML = `
                                <div class="alert alert-success" role="alert">
                                    <i class="bi bi-check-circle-fill me-2"></i>
                                    All endpoints are currently active
                                </div>
                            `;
                        } else {
                            statusDiv.innerHTML = `
                                <div class="alert alert-danger" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    Some endpoints are currently failing
                                </div>
                            `;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const statusDiv = document.getElementById('endpoints-status');
                        statusDiv.innerHTML = `
                            <div class="alert alert-danger" role="alert">
                                <i class="bi bi-exclamation-circle-fill me-2"></i>
                                Failed to load status
                            </div>
                        `;
                    });
            }
            updateActionsStatus();
            updateEndpointsStatus();
            setInterval(updateActionsStatus, 60000); // Update every minute
            setInterval(updateEndpointsStatus, 60000); // Update every minute
        });
    </script>
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="card-title mb-0">Recent Notifications</h5>
                        <a href="{% url 'notifications' %}" class="btn btn-success">
                            <i class="bi bi-bell-fill me-2"></i>View All Notifications
                        </a>
                    </div>
                    <ul class="list-group list-group-flush mt-3">
                        {% if notifications %}
                            {% for notification in notifications %}
                                <div class="alert {% if notification.type == 'success' %}alert-success{% elif notification.type == 'failure' %}alert-danger{% else %}alert-info{% endif %} d-flex align-items-center" role="alert">
                                    <i class="bi bi-{% if notification.type == 'success' %}check-circle-fill{% elif notification.type == 'failure' %}x-circle-fill{% else %}info-circle-fill{% endif %} me-2"></i>
                                    <div>
                                        {{ notification.message }}
                                        <small class="text-muted ms-2">
                                            {{ notification.created_at|timesince }} ago
                                        </small>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <li class="list-group-item">
                                <i class="bi bi-bell me-2"></i>
                                No notifications yet
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-12">
            {% include "components/notification_methods.html" %}
        </div>
    </div>
</div>
